<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>My Works</title>
  <link rel="stylesheet" href="./styles.css" />
  <!-- Cloudflare Turnstile -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>


<body>
  <div id="app">
    <header class="site-header">
      <div class="container header-row">
        <div>
          <h1 class="site-title">{{ site.title }}</h1>
          <p class="site-subtitle">{{ site.subtitle }}</p>
        </div>
      </div>
    </header>

    <main class="container">
      <section class="panel">
        <div class="panel-row">
          <input
            class="input"
            type="search"
            v-model="query"
            placeholder="Search by title, genre, or keywords…"
            aria-label="Search books"
          />
          <select class="select" v-model="genreFilter" aria-label="Filter by genre">
            <option value="">All genres</option>
            <option v-for="g in genres" :key="g" :value="g">{{ g }}</option>
          </select>
        </div>

        <div class="grid">
          <article
            class="card"
            v-for="b in filteredBooks"
            :key="b.id"
            @click="openBook(b)"
            role="button"
            tabindex="0"
            @keydown.enter="openBook(b)"
          >
            <div class="cover" :style="coverStyle(b)"></div>
            <div class="card-body">
              <h3 class="book-title">{{ b.title }}</h3>
              <p class="book-meta">
                <span class="pill">{{ b.year }}</span>
                <span class="pill">{{ b.genre }}</span>
                <span class="pill" v-if="b.status">{{ b.status }}</span>
              </p>

              <p class="book-blurb">{{ b.blurb }}</p>

              <div class="rating-row">
                <div class="stars" :aria-label="'Average rating: ' + avgRating(b.id).toFixed(1) + ' out of 5'">
                  <span v-for="n in 5" :key="n" class="star" :class="{ filled: n <= Math.round(avgRating(b.id)) }">★</span>
                </div>
                <div class="rating-count">{{ ratingCount(b.id) }} ratings</div>
              </div>
            </div>
          </article>
        </div>
      </section>

      <!-- Book Detail Modal -->
      <div class="modal-backdrop" v-if="activeBook" @click.self="closeBook()">
        <div class="modal" role="dialog" aria-modal="true">
          <div class="modal-header">
            <div>
              <h2 class="modal-title">{{ activeBook.title }}</h2>
              <div class="modal-meta">
                <span class="pill">{{ activeBook.year }}</span>
                <span class="pill">{{ activeBook.genre }}</span>
                <span class="pill" v-if="activeBook.status">{{ activeBook.status }}</span>
              </div>
            </div>
            <button class="icon-btn" @click="closeBook()" aria-label="Close">✕</button>
          </div>

          <div class="modal-content">
            <div class="modal-left">
              <img
                class="poster"
                :src="activeBook.cover"
                :alt="activeBook.title + ' cover'"
                />

              <div class="links" v-if="activeBook.links && activeBook.links.length">
                <a
                  class="btn"
                  v-for="(l, idx) in activeBook.links"
                  :key="idx"
                  :href="l.url"
                  target="_blank"
                  rel="noreferrer"
                >{{ l.label }}</a>
              </div>

              <div class="section">
                <h3 class="section-title">Synopsis</h3>
                <p class="text">{{ activeBook.synopsis }}</p>
              </div>

              <div class="section" v-if="activeBook.tags && activeBook.tags.length">
                <h3 class="section-title">Tags</h3>
                <div class="tag-row">
                  <span class="tag" v-for="t in activeBook.tags" :key="t">{{ t }}</span>
                </div>
              </div>
            </div>

            <div class="modal-right">
              <div class="section">
                <h3 class="section-title">Rate this book</h3>

                <div class="rate-box">
                  <div class="stars clickable" aria-label="Your rating">
                    <button
                      v-for="n in 5"
                      :key="n"
                      class="star-btn"
                      :class="{ filled: n <= myDraftRating }"
                      @click="setDraftRating(n)"
                      type="button"
                      :aria-label="'Rate ' + n + ' stars'"
                    >★</button>
                  </div>

                  <div class="rate-actions">
                    <button class="btn" @click="submitRating()" :disabled="myDraftRating === 0">Submit rating</button>
                  </div>

                  <p class="muted">
                    Avg: <b>{{ avgRating(activeBook.id).toFixed(1) }}</b> ({{ ratingCount(activeBook.id) }} ratings)
                    <br />
                  </p>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">Comments</h3>

                <form class="comment-form" @submit.prevent="submitComment()">
                  <div class="row">
                    <input class="input" v-model.trim="commentDraft.name" placeholder="Name (required)" required />
                    <input class="input" v-model.trim="commentDraft.email" placeholder="Email (optional, not public)" type="email" />
                  </div>
                  <textarea class="textarea" v-model.trim="commentDraft.text" placeholder="Write a comment…" required></textarea>
                  <div class="turnstile-slot">
                    <div id="turnstile-box"></div>
                  </div>
                  <div class="row end">
                    <button class="btn" type="submit" :disabled="!commentDraft.name || !commentDraft.text">Post comment</button>
                  </div>

                  <p class="muted">
                    Comments are <b>approved before public display</b> in the real site.
                    For local testing, your comments show instantly.
                  </p>
                </form>

                <div class="comment-list">
                  <div class="comment" v-for="c in commentsFor(activeBook.id)" :key="c.id">
                    <div class="comment-head">
                      <b class="comment-name">{{ c.name }}</b>
                      <span class="comment-date">{{ formatDate(c.createdAt) }}</span>
                    </div>
                    <p class="comment-text">{{ c.text }}</p>
                  </div>

                  <p class="muted" v-if="commentsFor(activeBook.id).length === 0">
                    No comments yet. Be the first.
                  </p>
                </div>
              </div>

            </div>
          </div>

          <div class="modal-footer">
          </div>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container footer-row">
        <span>© {{ new Date().getFullYear() }} {{ site.author }}</span>

      </div>
    </footer>
  </div>

  <!-- Vue 2 (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.min.js"></script>
  <script src="./app.js?v=8"></script>
</body>
</html>









